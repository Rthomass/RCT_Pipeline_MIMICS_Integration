This is a set of scripts to follow the rct-pipeline created by ([Wanxin](https://github.com/Rthomass/test/edit/main/README.md)). Using this data this set of scritps creates a set of parameters, inputs the parameters into the mmimics model and runs the mimics model, saving the model output into one comprehensive dataset. 

Its purpose is to:  

# Overview

i. First, output a segment level csv dataset for each tile and plot.  
ii. then using the segment level dataset, create a input parameter dataset suitable for the mimics model
iii. A rapper script then 
iv. run mimics and create a new dataset including all input parameters and radar backscatter reponse.

## Step 1. get_tree_data.py
The first script creates a csv containing the segment data for your selected trees in each plot & tile. 

To run this ensure the rct-pipeline has been used to produce a directory of tree files describing the structrual attributes of each tree QSM. See path example below:  

.../rct_extraction/angola_p02_raycloud_-2_1_treesplit/angola_p02_raycloud_-2_1_trees_12_info.txt

Additionally, a reference file containing  quality assessments is required (see matched_stems_picked.csv). This is a list of tree ids that have been manually checked, ensuring no errors inherent in the models. Simply write 'good' in the suitabiltiy coloumn to select trees. Addtionally the  height at which the crown starts should be recorded for later calculations. 



## Step 2. create_parameters
This next script transforms raw segment-level tree data (Step 1 Output) into tree-level input parameter sets suitable for the mimics model. 

### Running
The min_branch_order and max_branch_order parameters control which trees are included in the analysis and what branch data is calculated for each tree. This is for both quality control - ensures all trees have suffienent branching - and consistency - All trees in the final dataset have the same range of branch orders.

min_branch_order (Quality Filter) sets the minimum branch order requirement for trees to be included in the dataset. By default min_branch_order=3, meaning, only trees that have at least branch order 3 will be included. 
max_branch_order (Data Scope) determines how many branch orders to calculate statistics for:

#### Parameters 
Some parameters cannot be derived from the rct data. Currently these values are simply hard-coded and include the following: 

            tree_data['canopy_density'] = 0.015
            
            tree_data['frequency'] = 0.5
            tree_data['angle'] = 30

            tree_data['soil_moisture'] = 0.5
            tree_data['rms_height'] = 1.5
            tree_data['correlation_length'] = 17.5
            tree_data['percent_sand'] = 40
            tree_data['percent_clay'] = 10
            
            tree_data['trunk_moisture'] = 0.5
            tree_data['branch_1_moisture'] = 0.5
            tree_data['branch_2_moisture'] = 0.5
            tree_data['branch_3_moisture'] = 0.5
            tree_data['branch_4_moisture'] = 0.5
            tree_data['branch_5_moisture'] = 0.5

Wood density values 
### Frequency






The following parameters are calculated using data from the rct-pipeline files
### Branch Probability Density Functions
Within the MIMICS model, the probability density function for any given branch order is determined by selecting the best-fitting function from a predefined library of 15 mathematical functions. These functions range from uniform distributions to various powers of sine functions with different phase shifts, allowing the model to capture diverse branching angle patterns across different tree species and branch hierarchies.
### Crown Volume
###




## Input Files
matched_stems_picked.csv: 




Tree info files: *_trees_*_info.txt files generated by treeinfo containing segment data
Leaf files: *_leaves.ply files containing 3D mesh data for leaf area calculations
## Explanation
1. This script processes the tree data to create datasets for research. It starts by reading a reference file that identifies which trees are marked as "good" quality. 
2.
3.   then searches through the rct-pipeline directories generated by the treeinfo tool to find matching data. For each good tree, it extracts detailed segment information, calculates leaf area from 3D mesh files when available, and combines all the data into organized CSV files grouped by plot and tile coordinates. The result is a clean dataset that merges tree structural data, segment attributes, and leaf measurements for further analysis.
Input Files



Output
CSV files named angola_{plot_id}_{tile_coords}_combined.csv containing merged tree data for analysis.


